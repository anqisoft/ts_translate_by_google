import{LF}from"https://raw.githubusercontent.com/anqisoft/ts_utils/main/index.ts";import{doubleClick,findElementByCss,navigateTo,sendKeysAndReturn,waitUtilElementLocatedByCssAndGetText}from"https://raw.githubusercontent.com/anqisoft/ts_selenium/main/index.ts";export const TRANSLATE_MAX_CHAR_COUNT_PER_TIME=5e3;export const WAIT_ELEMENT_VISIBLE_MILLISECONDS=4e3;export const GOOGLE_TRANSLATE_LANG_EN="en";export const GOOGLE_TRANSLATE_LANG_CN="zh-CN";export const GOOGLE_TRANSLATE_LANG_TW="zh-TW";const URL_PREFIX="https://translate.google.com/details?sl=";const URL_MIDDELE="&tl=";const FROM_CSS=".er8xn";const TO_CSS=".lRu31";export async function translateByGoogle(t,e,_,n){const E=`${URL_PREFIX}${_}${URL_MIDDELE}${n}`;await navigateTo(t,E);let i=await findElementByCss(t,FROM_CSS);const s=e.length;if(s<=TRANSLATE_MAX_CHAR_COUNT_PER_TIME){await doubleClick(t,i);await sendKeysAndReturn(i,e);return await waitUtilElementLocatedByCssAndGetText(t,TO_CSS,WAIT_ELEMENT_VISIBLE_MILLISECONDS)}const T=[];let o=e;let A=s;const a=`</${_===GOOGLE_TRANSLATE_LANG_EN?"en_us":_.replaceAll("-","_").toLowerCase()}>`;const L=a.length;do{let s="";if(A<=TRANSLATE_MAX_CHAR_COUNT_PER_TIME){s=o}else{const R=o.substring(0,TRANSLATE_MAX_CHAR_COUNT_PER_TIME).lastIndexOf(a);if(R>-1&&R+L<=TRANSLATE_MAX_CHAR_COUNT_PER_TIME){s=o.substring(0,R+L)}else{let n=false;(_===GOOGLE_TRANSLATE_LANG_EN?"\n.?! ":"\n。？！ ").split("").forEach(t=>{if(n){return}const e=o.substring(0,TRANSLATE_MAX_CHAR_COUNT_PER_TIME).lastIndexOf(t);if(e>0){s=o.substring(0,e);n=true}});if(!n){s=o.substring(0,TRANSLATE_MAX_CHAR_COUNT_PER_TIME)}}}const l=s.length;o=o.substring(l);A=o.length;await doubleClick(t,i);await sendKeysAndReturn(i,s);T.push(await waitUtilElementLocatedByCssAndGetText(t,TO_CSS,WAIT_ELEMENT_VISIBLE_MILLISECONDS));if(A===0){break}await navigateTo(t,E);i=await findElementByCss(t,FROM_CSS)}while(A);return T.join(LF)}