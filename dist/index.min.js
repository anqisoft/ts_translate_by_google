import{LF}from"https://raw.githubusercontent.com/anqisoft/ts_utils/main/index.ts";import{doubleClick,findElementByCss,navigateTo,sendKeysAndReturn,waitUtilElementLocatedByCssAndGetText}from"https://raw.githubusercontent.com/anqisoft/ts_selenium/main/index.ts";export const TRANSLATE_MAX_CHAR_COUNT_PER_TIME=5e3;export const WAIT_ELEMENT_VISIBLE_MILLISECONDS=4e4;export const GOOGLE_TRANSLATE_LANG_EN="en";export const GOOGLE_TRANSLATE_LANG_CN="zh-CN";export const GOOGLE_TRANSLATE_LANG_TW="zh-TW";const URL_PREFIX="https://translate.google.com/details?sl=";const URL_MIDDELE="&tl=";const FROM_CSS=".er8xn";const TO_CSS=".lRu31";export async function translateByGoogle(e,n,E,t){const i=`${URL_PREFIX}${E}${URL_MIDDELE}${t}`;await navigateTo(e,i);let o=await findElementByCss(e,FROM_CSS);const s=n.length;if(s<=TRANSLATE_MAX_CHAR_COUNT_PER_TIME){await doubleClick(e,o);await sendKeysAndReturn(o,n);return await waitUtilElementLocatedByCssAndGetText(e,TO_CSS,WAIT_ELEMENT_VISIBLE_MILLISECONDS)}else{const T=[];let _=n;let t=s;const A=`</${E===GOOGLE_TRANSLATE_LANG_EN?"en_us":E.replaceAll("-","_").toLowerCase()}>`;const a=A.length;do{let s="";if(t<=TRANSLATE_MAX_CHAR_COUNT_PER_TIME){s=_}else{const L=_.substring(0,TRANSLATE_MAX_CHAR_COUNT_PER_TIME).lastIndexOf(A);if(L>-1&&L+a<=TRANSLATE_MAX_CHAR_COUNT_PER_TIME){s=_.substring(0,L+a)}else{let n=false;(E===GOOGLE_TRANSLATE_LANG_EN?"\n.?! ":"\n。？！ ").split("").forEach(t=>{if(n)return;const e=_.indexOf(t);if(e>0){s=_.substring(0,e);n=true}});if(!n){s=_.substring(0,TRANSLATE_MAX_CHAR_COUNT_PER_TIME)}}}await sendKeysAndReturn(o,s);_=_.substring(s.length);T.push(await waitUtilElementLocatedByCssAndGetText(e,TO_CSS,WAIT_ELEMENT_VISIBLE_MILLISECONDS));t=_.length;if(t==0){break}await navigateTo(e,i);o=await findElementByCss(e,FROM_CSS)}while(true);return T.join(LF)}}